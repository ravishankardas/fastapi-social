<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Social Media Web App</title>
    <style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f4f4f4;
    }

    .navbar {
        display: flex; /* Use flexbox for alignment */
        justify-content: space-between; /* Space between logo and links */
        align-items: center; /* Center vertically */
        background-color: #333;
        padding: 15px 20px;
        position: fixed;
        width: 100%;
        top: 0;
        left: 0;
        z-index: 1000;
        opacity: 0.9;
        color: #fff;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        margin-bottom: 100px;
    }

    .navbar h3 {
        margin: 0;
        font-size: 1.5rem;
        cursor: pointer;
        color: #ffd700; /* Gold color for better visibility */
    }

    .navbar h3:hover {
        color: #fff; /* Change color on hover */
    }

    .navbar a {
        color: #fff; /* Link color */
        text-decoration: none; /* Remove underline */
        padding: 10px 15px; /* Add padding for better touch target */
        margin: 0;
        border-radius: 5px; /* Rounded corners */
        transition: background-color 0.3s, color 0.3s; /* Smooth transition */
    }

    .navbar a:not(:last-child) {
        margin-right: 0; /* Ensure no margin on the right of the first link */
    }

    .navbar a:hover {
        background-color: #ffd700; /* Gold background on hover */
        color: #333; /* Dark text color on hover */
    }

    .unclickable {
        pointer-events: none; /* Disable click events */
        color: #fff; /* Ensure the text color remains visible */
        text-decoration: none; /* Remove underline */
    }

    .unclickable:hover {
        color: #fff; /* Keep the color consistent */
        text-shadow: none; /* Remove text shadow */
    }

    .main_text {
        margin-top: 100px;
        text-align: center;
    }

    .form-container {
        display: none; /* Hide forms by default */
    }

    .form-active {
        display: block; /* Show form when active */
    }
    .signinForm
    {
        display: none;
    }


    </style>
</head>
<body>
    <div class="navbar">
        <h3>Social Media Web App</h3>
        <a href="#" onclick="toggleForm('signin')" id="signin_text">Sign In</a>
        <a href="#" onclick="toggleForm('login')" id="login_text">Log In</a>
    </div>

    <div class="main_text">
        <h3 id="welcome_text">Welcome to the social media app</h3>

        <!-- Sign In Form -->
        <div id="signinForm" class="form-container form-active">
            <form id="createUserForm" onsubmit="submitSignInForm(event);">
            <h2>Create a new user</h2>

                <label for="email">Email:</label><br>
                <input type="email" id="signin_email" name="email" required><br><br>
                <label for="password">Password:</label><br>
                <input type="password" id="signin_password" name="password" required><br><br>
                <button type="submit">Submit</button>
            </form>
        </div>

        <!-- Log In Form -->
        <div id="loginForm" class="form-container">
            <form id="loginUserForm" onsubmit="submitLoginForm(event);">
                <h2>Log In</h2>
                <label for="login_email">Email:</label><br>
                <input type="email" id="login_email" name="email" required><br><br>
                <label for="login_password">Password:</label><br>
                <input type="password" id="login_password" name="password" required><br><br>
                <button type="submit">Log In</button>
            </form>
        </div>
    </div>

    <script>
        window.onload = function() {
            document.getElementById("signin_email").value = ""; // Set email to empty
            document.getElementById("signin_password").value = ""; // Set password to empty
            document.getElementById("login_email").value = ""; // Set login email to empty
            document.getElementById("login_password").value = ""; // Set login password to empty
            document.getElementById("signinForm").style.display = "none";
            document.getElementById("loginUserForm").style.display = "none";

        };

        // Function to toggle between Sign In and Log In forms
        function toggleForm(formType) {
            const signinForm = document.getElementById("signinForm");
            const loginForm = document.getElementById("loginForm");

            if (formType === 'signin') {
                signinForm.classList.add('form-active');
                loginForm.classList.remove('form-active');
                document.getElementById("signinForm").style.display = "block";
            } else if (formType === 'login') {
                loginForm.classList.add('form-active');
                signinForm.classList.remove('form-active');
                document.getElementById("signinForm").style.display = "none";
                document.getElementById("loginUserForm").style.display = "block";
            }
        }

        async function submitSignInForm(event) {
            event.preventDefault(); // Prevent the default form submission

            const userData = {
                email: document.getElementById("signin_email").value,
                password: document.getElementById("signin_password").value
            };

            try {
                const response = await fetch("https://fastapi-social-ravi-232824ba7d56.herokuapp.com/users", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(userData)
                });

                if (response.status === 201) {
                    const responseData = await response.json();
                    const username = responseData.email.split('@')[0]; // Extract part before '@'
                    alert("User created successfully!");
                    updateNavbarWithUsername(username);
                    document.getElementById("createUserForm").style.display = "none"; // Hide the form
                } else {
                    const errorData = await response.json();
                    alert(`Error: ${errorData.detail}`); // Will show "User already exists"
                }
            } catch (error) {
                alert("An error occurred: " + error.message);
            }
        }

        async function submitLoginForm(event) {
            event.preventDefault(); // Prevent the default form submission

            const loginData = {
                email: document.getElementById("login_email").value,
                password: document.getElementById("login_password").value
            };

            // Call your API for login here (this is just an example)
            // Replace with the actual login endpoint
            try {
                const response = await fetch("http://127.0.0.1:8000/login", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(loginData)
                });

                if (response.ok) {
                    const responseData = await response.json();
                    const username = responseData.email.split('@')[0]; // Extract part before '@'
                    alert("Login successful!");
                    updateNavbarWithUsername(username);
                    document.getElementById("loginForm").style.display = "none"; // Hide the login form
                } else {
                    const errorData = await response.json();
                    alert(`Login failed: ${errorData.detail}`); // Show error message
                }
            } catch (error) {
                alert("An error occurred: " + error.message);
            }
        }

        // Function to update the navbar with the username
        function updateNavbarWithUsername(username) {
            const signinLink = document.getElementById("signin_text");
            signinLink.textContent = username;
            signinLink.onclick = null; // Make unclickable
            signinLink.classList.add('unclickable'); // Disable hover effect
            document.getElementById("login_text").style.display = "none"; // Hide login link
        }
    </script>
</body>
</html>
